nome : principal

em : [pressione]

empregos :
  teste :
    run-on : ubuntu-latest

    passos :
      - usa : actions/checkout@v2
      - usa : actions/setup-node@v2
        com :
          cache : fio
          versão do nó : 16
      - run : yarn install --frozen-lockfile

      - run : tipo de fio
      - corrida : fiapos de fios
      - executar : teste de fio --ci

  teste-ação :
    run-on : ubuntu-latest
    passos :
      - usa : actions/checkout@v2

      - name : atualize action.yml para usar a imagem do Dockerfile local
        executar : |
          sed -i "s/image: .*/image: Dockerfile/" action.yml
      - nome : generate-snake-game-from-github-contribution-grid
        id : gerar-snake
        usa : ./
        com :
          github_user_name : thiagocarvalhorodrigues
          saídas : |
            dist/github-contribution-grid-snake.svg
            dist/github-contribution-grid-snake-dark.svg?palette=github-dark
            dist/github-contribution-grid-snake.gif?color_snake=orange&color_dots=#bfd6f6,#8dbdff,#64a1f4,#4b91f1,#3c7dd9
      - nome : certifique-se de que o arquivo gerado existe
        executar : |
          ls dist
          test -f dist/github-contribution-grid-snake.svg
          test -f dist/github-contribution-grid-snake-dark.svg
          test -f dist/github-contribution-grid-snake.gif
      - usa : crazy-max/ghaction-github-pages@v2.5.0
        com :
          target_branch : saída
          build_dir : dist
        ambiente :
          GITHUB_TOKEN : ${{ secrets.GITHUB_TOKEN }}

  deploy-ghpages :
    run-on : ubuntu-latest
    passos :
      - usa : actions/checkout@v2
      - usa : actions/setup-node@v2
        com :
          cache : fio
          versão do nó : 16
      - run : yarn install --frozen-lockfile

      - run : yarn build:demo
        ambiente :
          GITHUB_USER_CONTRIBUTION_API_ENDPOINT : https://snk-one.vercel.app/api/github-user-contribution/

      - usa : crazy-max/ghaction-github-pages@v2.6.0
        if : success() && github.ref == 'refs/heads/main'
        com :
          target_branch : gh-pages
          build_dir : packages/demo/dist
        ambiente :
          GITHUB_TOKEN : ${{ secrets.MY_GITHUB_TOKEN_GH_PAGES }}
